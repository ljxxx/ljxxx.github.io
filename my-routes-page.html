<!-- ÊàëÁöÑÁ∫øË∑ØÈ°µÈù¢ -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaaS - ÊàëÁöÑÁ∫øË∑Ø</title>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* È°∂ÈÉ®Â∑•ÂÖ∑Ê†è */
        .top-bar {
            background: white;
            padding: 60px 20px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #edf2f7;
            border-color: #667eea;
        }
        
        /* Âú∞ÂõæÂÆπÂô® */
        .map-container {
            flex: 1;
            position: relative;
            background: #e2e8f0;
            overflow: hidden;
        }
        
        #mapContainer {
            width: 100%;
            height: 100%;
        }
        
        /* Á∫øË∑ØÂàóË°®Èù¢Êùø */
        .routes-panel {
            position: absolute;
            top: 0;
            right: 0;
            width: 320px;
            height: 100%;
            background: white;
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .routes-panel.open {
            transform: translateX(0);
        }
        
        .panel-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .panel-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .panel-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .routes-list {
            padding: 20px 0;
        }
        
        .route-item {
            margin: 0 20px 16px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .route-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .route-item.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        
        .route-name {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .route-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
        }
        
        .stat {
            flex: 1;
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #667eea;
            display: block;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
            display: block;
        }
        
        .route-segments {
            margin-bottom: 12px;
        }
        
        .segment-item {
            display: flex;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .segment-item:last-child {
            border-bottom: none;
        }
        
        .segment-icon {
            width: 24px;
            height: 24px;
            background: #f7fafc;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 12px;
        }
        
        .segment-info {
            flex: 1;
        }
        
        .segment-name {
            font-size: 12px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 2px;
        }
        
        .segment-details {
            font-size: 10px;
            color: #718096;
        }
        
        .segment-duration {
            font-size: 10px;
            color: #667eea;
            font-weight: 600;
        }
        
        .route-features {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        
        .feature-tag {
            background: #e6fffa;
            color: #234e52;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .route-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .btn-small {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-edit {
            background: #667eea;
            color: white;
        }
        
        .btn-edit:hover {
            background: #5a67d8;
        }
        
        .btn-delete {
            background: #f7fafc;
            color: #e53e3e;
            border: 2px solid #e53e3e;
        }
        
        .btn-delete:hover {
            background: #e53e3e;
            color: white;
        }
        
        /* Á∫øË∑ØÂàõÂª∫Èù¢Êùø */
        .create-route-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        
        .create-route-form {
            background: white;
            border-radius: 24px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .form-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .waypoints-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .waypoint-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .waypoint-item:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }
        
        .waypoint-number {
            width: 24px;
            height: 24px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
        }
        
        .waypoint-info {
            flex: 1;
        }
        
        .waypoint-name {
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .waypoint-address {
            font-size: 12px;
            color: #718096;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn-cancel {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        .btn-cancel:hover {
            background: #edf2f7;
        }
        
        /* ËΩ®ËøπËÆ∞ÂΩïÁä∂ÊÄÅ */
        .tracking-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(72, 187, 120, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            z-index: 50;
            display: none;
        }
        
        .tracking-indicator.visible {
            display: block;
        }
        
        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .empty-description {
            font-size: 16px;
            margin-bottom: 24px;
        }
        
        /* Â∫ïÈÉ®ÂØºËà™ */
        .bottom-nav {
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            padding: 8px 0 20px;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-item.active {
            color: #667eea;
        }
        
        .nav-item:hover {
            color: #667eea;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }
        
        /* Âú∞ÂõæÊéßÂà∂ÊåâÈíÆ */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 50;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .control-btn.active {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
        <div class="top-bar">
            <h1 class="page-title">ÊàëÁöÑÁ∫øË∑Ø</h1>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="toggleRoutesPanel()">üìã Á∫øË∑Ø</button>
                <button class="btn btn-primary" onclick="showCreateRouteForm()">‚ûï ÂàõÂª∫</button>
            </div>
        </div>
        
        <!-- Âú∞ÂõæÂÆπÂô® -->
        <div class="map-container">
            <div id="mapContainer"></div>
            
            <!-- Âú∞ÂõæÊéßÂà∂ÊåâÈíÆ -->
            <div class="map-controls">
                <button class="control-btn" onclick="toggleTracking()" title="ËΩ®ËøπËÆ∞ÂΩï">üìç</button>
                <button class="control-btn" onclick="centerMap()" title="Â±Ö‰∏≠ÊòæÁ§∫">üè†</button>
                <button class="control-btn" onclick="toggleMapStyle()" title="ÂàáÊç¢Âú∞ÂõæÊ†∑Âºè">üó∫Ô∏è</button>
            </div>
            
            <!-- ËΩ®ËøπËÆ∞ÂΩïÁä∂ÊÄÅÊåáÁ§∫Âô® -->
            <div class="tracking-indicator" id="trackingIndicator">
                üìç Ê≠£Âú®ËÆ∞ÂΩïËΩ®Ëøπ...
            </div>
            
            <!-- Á∫øË∑ØÂàóË°®Èù¢Êùø -->
            <div class="routes-panel" id="routesPanel">
                <div class="panel-header">
                    <h3 class="panel-title">ÊàëÁöÑÁ∫øË∑Ø</h3>
                    <p class="panel-subtitle">ÂÖ± 5 Êù°Á∫øË∑Ø</p>
                </div>
                
                <div class="routes-list" id="routesList">
                    <!-- Âä®ÊÄÅÁîüÊàêÁ∫øË∑ØÂàóË°® -->
                </div>
            </div>
            
            <!-- Á∫øË∑ØÂàõÂª∫Èù¢Êùø -->
            <div class="create-route-panel" id="createRoutePanel">
                <div class="create-route-form">
                    <h2 class="form-title">ÂàõÂª∫Êñ∞Á∫øË∑Ø</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Á∫øË∑ØÂêçÁß∞</label>
                        <input type="text" class="form-input" placeholder="ËæìÂÖ•Á∫øË∑ØÂêçÁß∞" id="routeName">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ë∑ØÂæÑÁÇπ</label>
                        <div class="waypoints-list" id="waypointsList">
                            <div class="waypoint-item" onclick="addWaypoint()">
                                <div class="waypoint-number">+</div>
                                <div class="waypoint-info">
                                    <div class="waypoint-name">Ê∑ªÂä†Ë∑ØÂæÑÁÇπ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-cancel" onclick="hideCreateRouteForm()">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" onclick="saveNewRoute()">ÂàõÂª∫Á∫øË∑Ø</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Â∫ïÈÉ®ÂØºËà™ -->
        <div class="bottom-nav">
            <div class="nav-item" onclick="navigateTo('planning')">
                <div class="nav-icon">üó∫Ô∏è</div>
                <div class="nav-label">ËßÑÂàí</div>
            </div>
            <div class="nav-item active" onclick="navigateTo('routes')">
                <div class="nav-icon">üìã</div>
                <div class="nav-label">Á∫øË∑Ø</div>
            </div>
            <div class="nav-item" onclick="navigateTo('profile')">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">ÊàëÁöÑ</div>
            </div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let map;
        let geocoder;
        let currentRoute;
        let isTracking = false;
        let trackingPath = [];
        let routeMarkers = [];
        let routePolylines = [];
        
        // Á§∫‰æãÁ∫øË∑ØÊï∞ÊçÆ
        const sampleRoutes = [
            {
                id: 1,
                name: "Êó•Â∏∏ÈÄöÂã§Ë∑ØÁ∫ø",
                segments: [
                    { mode: "Âú∞ÈìÅ", from: "Â∞ñÊ≤ôÂíÄÁ´ô", to: "‰∏≠ÁéØÁ´ô", duration: "15ÂàÜÈíü", icon: "üöá" },
                    { mode: "Â∑¥Â£´", from: "‰∏≠ÁéØÁ´ô", to: "Ê∑±Âú≥ÊπæÂè£Â≤∏", duration: "25ÂàÜÈíü", icon: "üöå" },
                    { mode: "Ê≠•Ë°å", from: "Ê∑±Âú≥ÊπæÂè£Â≤∏", to: "ÁõÆÁöÑÂú∞", duration: "5ÂàÜÈíü", icon: "üö∂" }
                ],
                totalDuration: "45ÂàÜÈíü",
                totalCost: "HK$28",
                waypoints: [
                    { lng: 114.1717, lat: 22.2969, name: "Â∞ñÊ≤ôÂíÄÁ´ô" },
                    { lng: 114.1577, lat: 22.2783, name: "‰∏≠ÁéØÁ´ô" },
                    { lng: 113.9368, lat: 22.4903, name: "Ê∑±Âú≥ÊπæÂè£Â≤∏" }
                ],
                features: ["Â∏∏Áî®", "ÁªèÊµé"]
            },
            {
                id: 2,
                name: "Âë®Êú´Ë¥≠Áâ©Ë∑ØÁ∫ø",
                segments: [
                    { mode: "Â∑¥Â£´", from: "Ëµ∑ÁÇπ", to: "Ë¥≠Áâ©‰∏≠ÂøÉ", duration: "30ÂàÜÈíü", icon: "üöå" },
                    { mode: "Âú∞ÈìÅ", from: "Ë¥≠Áâ©‰∏≠ÂøÉ", to: "Â∏Ç‰∏≠ÂøÉ", duration: "20ÂàÜÈíü", icon: "üöá" },
                    { mode: "ÂÖ±‰∫´ÂçïËΩ¶", from: "Â∏Ç‰∏≠ÂøÉ", to: "ÁõÆÁöÑÂú∞", duration: "15ÂàÜÈíü", icon: "üö≤" }
                ],
                totalDuration: "1h 20min",
                totalCost: "HK$45",
                waypoints: [
                    { lng: 114.1717, lat: 22.2969, name: "Ëµ∑ÁÇπ" },
                    { lng: 114.1577, lat: 22.2783, name: "Ë¥≠Áâ©‰∏≠ÂøÉ" },
                    { lng: 114.1477, lat: 22.2683, name: "Â∏Ç‰∏≠ÂøÉ" }
                ],
                features: ["ËàíÈÄÇ", "Ë¥≠Áâ©"]
            },
            {
                id: 3,
                name: "‰∫≤Â≠êÊ∏∏Áé©Ë∑ØÁ∫ø",
                segments: [
                    { mode: "È´òÈìÅ", from: "Ë•ø‰πùÈæôÁ´ô", to: "Ê∑±Âú≥ÂåóÁ´ô", duration: "1h 30min", icon: "üöÑ" },
                    { mode: "Âú∞ÈìÅ", from: "Ê∑±Âú≥ÂåóÁ´ô", to: "‰∏ªÈ¢òÂÖ¨Âõ≠", duration: "45ÂàÜÈíü", icon: "üöá" },
                    { mode: "Ê≠•Ë°å", from: "‰∏ªÈ¢òÂÖ¨Âõ≠", to: "ÁõÆÁöÑÂú∞", duration: "15ÂàÜÈíü", icon: "üö∂" }
                ],
                totalDuration: "2h 30min",
                totalCost: "HK$120",
                waypoints: [
                    { lng: 114.1655, lat: 22.3034, name: "Ë•ø‰πùÈæôÁ´ô" },
                    { lng: 114.0306, lat: 22.6109, name: "Ê∑±Âú≥ÂåóÁ´ô" },
                    { lng: 113.9368, lat: 22.4903, name: "‰∏ªÈ¢òÂÖ¨Âõ≠" }
                ],
                features: ["È´òÈìÅ", "ËàíÈÄÇ"]
            }
        ];
        
        // ÂàùÂßãÂåñÂú∞Âõæ
        function initMap() {
            map = new AMap.Map('mapContainer', {
                zoom: 11,
                center: [114.057868, 22.543099], // È¶ôÊ∏Ø‰∏≠ÂøÉÁÇπ
                mapStyle: 'amap://styles/blue'
            });
            
            // ÂàùÂßãÂåñÂú∞ÁêÜÁºñÁ†ÅÊúçÂä°
            geocoder = new AMap.Geocoder({
                city: "ÂÖ®ÂõΩ",
                radius: 1000
            });
            
            // Âä†ËΩΩÁ§∫‰æãÁ∫øË∑Ø
            loadRoutes();
        }
        
        // Âä†ËΩΩÁ∫øË∑Ø
        function loadRoutes() {
            const routesList = document.getElementById('routesList');
            routesList.innerHTML = '';
            
            sampleRoutes.forEach(route => {
                const routeItem = createRouteItem(route);
                routesList.appendChild(routeItem);
            });
        }
        
        // ÂàõÂª∫Á∫øË∑ØÈ°π
        function createRouteItem(route) {
            const routeItem = document.createElement('div');
            routeItem.className = 'route-item';
            routeItem.onclick = () => selectRoute(route);
            
            routeItem.innerHTML = `
                <div class="route-name">${route.name}</div>
                <div class="route-stats">
                    <div class="stat">
                        <span class="stat-value">${route.totalDuration}</span>
                        <span class="stat-label">Áî®Êó∂</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value">${route.totalCost}</span>
                        <span class="stat-label">Ë¥πÁî®</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value">${route.segments.length}ÊÆµ</span>
                        <span class="stat-label">Ë∑ØÊÆµ</span>
                    </div>
                </div>
                <div class="route-segments">
                    ${route.segments.map(segment => `
                        <div class="segment-item">
                            <div class="segment-icon">${segment.icon}</div>
                            <div class="segment-info">
                                <div class="segment-name">${segment.mode}</div>
                                <div class="segment-details">${segment.from} ‚Üí ${segment.to}</div>
                            </div>
                            <div class="segment-duration">${segment.duration}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="route-features">
                    ${route.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                </div>
                <div class="route-actions">
                    <button class="btn-small btn-edit" onclick="editRoute(event, ${route.id})">ÁºñËæë</button>
                    <button class="btn-small btn-delete" onclick="deleteRoute(event, ${route.id})">Âà†Èô§</button>
                </div>
            `;
            
            return routeItem;
        }
        
        // ÈÄâÊã©Ë∑ØÁ∫ø
        function selectRoute(route) {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÊ†áËÆ∞ÂíåË∑ØÂæÑ
            clearMap();
            
            // Ê∑ªÂä†Ë∑ØÂæÑÁÇπÊ†áËÆ∞
            route.waypoints.forEach((waypoint, index) => {
                const marker = new AMap.Marker({
                    position: [waypoint.lng, waypoint.lat],
                    map: map,
                    icon: new AMap.Icon({
                        size: new AMap.Size(32, 32),
                        image: index === 0 ? 
                            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTIiIGZpbGw9IiM0OGJiNzgiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iOCIgZmlsbD0id2hpdGUiLz4KPC9zdmc+' :
                            index === route.waypoints.length - 1 ?
                            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTIiIGZpbGw9IiNlNTNlM2UiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iOCIgZmlsbD0id2hpdGUiLz4KPC9zdmc+' :
                            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTIiIGZpbGw9IiM2NjdlZWEiLz4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iOCIgZmlsbD0id2hpdGUiLz4KPC9zdmc+',
                        imageSize: new AMap.Size(32, 32)
                    })
                });
                routeMarkers.push(marker);
            });
            
            // Ê∑ªÂä†Ë∑ØÂæÑÁ∫ø
            for (let i = 0; i < route.waypoints.length - 1; i++) {
                const polyline = new AMap.Polyline({
                    path: [
                        [route.waypoints[i].lng, route.waypoints[i].lat],
                        [route.waypoints[i + 1].lng, route.waypoints[i + 1].lat]
                    ],
                    strokeColor: '#667eea',
                    strokeWeight: 4,
                    strokeOpacity: 0.8,
                    map: map
                });
                routePolylines.push(polyline);
            }
            
            // Ë∞ÉÊï¥Âú∞ÂõæËßÜÈáé
            map.setFitView(routeMarkers);
            
            // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.route-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            currentRoute = route;
        }
        
        // Ê∏ÖÈô§Âú∞ÂõæÊ†áËÆ∞ÂíåË∑ØÂæÑ
        function clearMap() {
            routeMarkers.forEach(marker => marker.setMap(null));
            routePolylines.forEach(polyline => polyline.setMap(null));
            routeMarkers = [];
            routePolylines = [];
        }
        
        // ÂàáÊç¢Á∫øË∑ØÈù¢Êùø
        function toggleRoutesPanel() {
            const panel = document.getElementById('routesPanel');
            panel.classList.toggle('open');
        }
        
        // ÊòæÁ§∫ÂàõÂª∫Á∫øË∑ØË°®Âçï
        function showCreateRouteForm() {
            document.getElementById('createRoutePanel').style.display = 'flex';
        }
        
        // ÈöêËóèÂàõÂª∫Á∫øË∑ØË°®Âçï
        function hideCreateRouteForm() {
            document.getElementById('createRoutePanel').style.display = 'none';
        }
        
        // Ê∑ªÂä†Ë∑ØÂæÑÁÇπ
        function addWaypoint() {
            const waypointsList = document.getElementById('waypointsList');
            const waypointCount = waypointsList.children.length;
            
            const waypointItem = document.createElement('div');
            waypointItem.className = 'waypoint-item';
            waypointItem.onclick = () => removeWaypoint(waypointItem);
            
            waypointItem.innerHTML = `
                <div class="waypoint-number">${waypointCount + 1}</div>
                <div class="waypoint-info">
                    <div class="waypoint-name">ÁÇπÂáªÂú∞ÂõæÈÄâÊã©‰ΩçÁΩÆ</div>
                    <div class="waypoint-address">ÈÄâÊã©Âú∞Âõæ‰∏äÁöÑ‰ΩçÁΩÆ</div>
                </div>
            `;
            
            waypointsList.appendChild(waypointItem);
        }
        
        // Âà†Èô§Ë∑ØÂæÑÁÇπ
        function removeWaypoint(waypointItem) {
            waypointItem.remove();
            updateWaypointNumbers();
        }
        
        // Êõ¥Êñ∞Ë∑ØÂæÑÁÇπÁºñÂè∑
        function updateWaypointNumbers() {
            const waypoints = document.querySelectorAll('.waypoint-item .waypoint-number');
            waypoints.forEach((number, index) => {
                number.textContent = index + 1;
            });
        }
        
        // ‰øùÂ≠òÊñ∞Á∫øË∑Ø
        function saveNewRoute() {
            const routeName = document.getElementById('routeName').value;
            if (!routeName) {
                alert('ËØ∑ËæìÂÖ•Á∫øË∑ØÂêçÁß∞');
                return;
            }
            
            // ÂàõÂª∫Êñ∞Á∫øË∑ØÂØπË±°
            const newRoute = {
                id: Date.now(),
                name: routeName,
                segments: [],
                totalDuration: "0ÂàÜÈíü",
                totalCost: "HK$0",
                waypoints: [],
                features: ["Êñ∞Âª∫"]
            };
            
            // Ê∑ªÂä†Âà∞Á§∫‰æãÊï∞ÊçÆ
            sampleRoutes.push(newRoute);
            
            // ÈöêËóèË°®Âçï
            hideCreateRouteForm();
            
            // Âà∑Êñ∞Á∫øË∑ØÂàóË°®
            loadRoutes();
            
            alert('Á∫øË∑ØÂàõÂª∫ÊàêÂäüÔºÅ');
        }
        
        // ÁºñËæëÁ∫øË∑Ø
        function editRoute(event, routeId) {
            event.stopPropagation();
            alert('ÁºñËæëÂäüËÉΩÂºÄÂèë‰∏≠...');
        }
        
        // Âà†Èô§Á∫øË∑Ø
        function deleteRoute(event, routeId) {
            event.stopPropagation();
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Á∫øË∑ØÂêóÔºü')) {
                const index = sampleRoutes.findIndex(route => route.id === routeId);
                if (index > -1) {
                    sampleRoutes.splice(index, 1);
                    loadRoutes();
                }
            }
        }
        
        // ÂàáÊç¢ËΩ®ËøπËÆ∞ÂΩï
        function toggleTracking() {
            isTracking = !isTracking;
            const indicator = document.getElementById('trackingIndicator');
            const btn = event.target;
            
            if (isTracking) {
                indicator.classList.add('visible');
                btn.classList.add('active');
                trackingPath = [];
                
                // ÂºÄÂßãËÆ∞ÂΩïËΩ®Ëøπ
                map.on('click', recordTrackingPoint);
            } else {
                indicator.classList.remove('visible');
                btn.classList.remove('active');
                
                // ÂÅúÊ≠¢ËÆ∞ÂΩïËΩ®Ëøπ
                map.off('click', recordTrackingPoint);
            }
        }
        
        // ËÆ∞ÂΩïËΩ®ËøπÁÇπ
        function recordTrackingPoint(e) {
            if (isTracking) {
                trackingPath.push(e.lnglat);
                
                // Âú®Âú∞Âõæ‰∏äÊ∑ªÂä†ËΩ®ËøπÁÇπ
                new AMap.Marker({
                    position: e.lnglat,
                    map: map,
                    icon: new AMap.Icon({
                        size: new AMap.Size(16, 16),
                        image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iOCIgY3k9IjgiIHI9IjYiIGZpbGw9IiM0OGJiNzgiLz4KPC9zdmc+',
                        imageSize: new AMap.Size(16, 16)
                    })
                });
            }
        }
        
        // Â±Ö‰∏≠ÊòæÁ§∫Âú∞Âõæ
        function centerMap() {
            if (currentRoute && currentRoute.waypoints.length > 0) {
                map.setFitView(routeMarkers);
            } else {
                map.setCenter([114.057868, 22.543099]);
                map.setZoom(11);
            }
        }
        
        // ÂàáÊç¢Âú∞ÂõæÊ†∑Âºè
        function toggleMapStyle() {
            const styles = [
                'amap://styles/blue',
                'amap://styles/dark',
                'amap://styles/light',
                'amap://styles/fresh'
            ];
            
            const currentStyle = map.getMapStyle();
            const currentIndex = styles.indexOf(currentStyle);
            const nextIndex = (currentIndex + 1) % styles.length;
            
            map.setMapStyle(styles[nextIndex]);
        }
        
        // ÂØºËà™ÂàáÊç¢
        function navigateTo(page) {
            switch(page) {
                case 'planning':
                    window.location.href = 'planning-page.html';
                    break;
                case 'routes':
                    // ÂΩìÂâçÈ°µÈù¢
                    break;
                case 'profile':
                    window.location.href = 'profile-page.html';
                    break;
            }
        }
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
        });
    </script>
</body>
</html>